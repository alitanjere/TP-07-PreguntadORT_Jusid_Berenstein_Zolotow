@{
    ViewBag.Title = "Inicio";
}

<div class="ruleta-container">
    <canvas id="canvas" width="500" height="500"></canvas>
    <img src="~/images/flecha.png" class="flecha" alt="Flecha">
    <button id="girarBtn" onclick="girarRuleta()">Girar</button>
</div>

<div id="resultado"></div>

@section Scripts {
    <script>
        let buttonClicked = false; // Variable para controlar el estado del botón
        const categorias = ["Historia", "Ciencia", "Geografía", "Arte", "Deportes"];
        const colores = ["#FF6F61", "#6B5B95", "#88B04B", "#F7CAC9", "#92A8D1"];
        const numSecciones = categorias.length;
        const anguloPorSeccion = 2 * Math.PI / numSecciones;
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        let anguloInicial = 0;

        function dibujarRuleta() {
            for (let i = 0; i < numSecciones; i++) {
                const anguloFinal = anguloInicial + anguloPorSeccion;
                ctx.beginPath();
                ctx.moveTo(canvas.width / 2, canvas.height / 2);
                ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, anguloInicial, anguloFinal);
                ctx.fillStyle = colores[i];
                ctx.fill();
                ctx.strokeStyle = "#FFFFFF"; // Borde blanco para un diseño más limpio
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.save();

                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.rotate(anguloInicial + anguloPorSeccion / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#FFFFFF";
                ctx.font = "bold 18px Arial";
                ctx.fillText(categorias[i], canvas.width / 2 - 20, 10);
                ctx.restore();

                anguloInicial = anguloFinal;
            }
        }

        function girarRuleta() {
            if (buttonClicked) return; // No permitir más clics
            buttonClicked = true;

            const rotacion = Math.floor(Math.random() * 3600) + 360;
            const duracion = 5; // duración en segundos
            canvas.style.transition = `transform ${duracion}s ease-out`;
            canvas.style.transform = `rotate(${rotacion}deg)`;

            setTimeout(() => {
                const anguloFinal = rotacion % 360;
                const indiceGanador = Math.floor(numSecciones - (anguloFinal / 360) * numSecciones) % numSecciones;

                document.getElementById("resultado").textContent = `¡La categoría es: ${categorias[indiceGanador]}!`;
                canvas.style.transition = "none"; // Para permitir más giros posteriores
                buttonClicked = false; // Permitir clics después de la animación
            }, duracion * 1000);
        }

        dibujarRuleta();
    </script>
}

<style>
    .ruleta-container {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 50px;
        box-shadow: 0px 15px 30px rgba(0, 0, 0, 0.3); /* Sombra global */
        background: #FFFFFF; /* Fondo blanco para eliminar el cuadrado */
        border-radius: 10px; /* Bordes redondeados */
        padding: 20px;
    }

    canvas {
        box-shadow: 0px 10px 20px rgba(0, 0, 0, 0.2);
        border-radius: 50%; /* Hacer la ruleta redonda */
    }

    .flecha {
        position: absolute;
        top: 40%;
        left: calc(50% + 80px); /* Ajuste para que esté pegada a la ruleta y hacia la derecha */
        transform: translateX(-50%) rotate(180deg); /* Rotar la imagen 180 grados */
        width: 120px; /* Tamaño más grande */
        height: 120px; /* Tamaño más grande */
        z-index: 10; /* Para que la flecha esté siempre visible encima de la ruleta */
    }

    button {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 100px; /* Tamaño redondo */
        height: 100px; /* Tamaño redondo */
        background-color: #2196F3; /* Azul */
        color: #fff;
        border: none;
        border-radius: 50%; /* Redondear el botón */
        font-size: 18px;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.3s, box-shadow 0.3s;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.3); /* Sombra del botón */
    }

    button:hover {
        background-color: #1976D2;
        transform: translate(-50%, -50%) scale(1.1); /* Agrandar al pasar el mouse */
        box-shadow: 0px 10px 20px rgba(0, 0, 0, 0.5); /* Sombra más intensa */
    }

    #resultado {
        text-align: center;
        font-size: 24px;
        margin-top: 20px;
        font-family: 'Arial', sans-serif;
        color: #333333;
    }
</style>
