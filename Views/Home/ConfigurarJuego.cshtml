@{
    ViewBag.Title = "Configuar Juego";
}

<div class="ConfigurarJuego">
    <form  id="Username">
        <div class="d-flex align-items-center justify-content-center">
            <h1>Ingrese su nombre de usuario</h5>
            <input type="text" id="nombreUsuario" required>
            <button onclick="ingresarUsuario()" id="botonUsuario">Ingresar</button>
        </div>
    </form>
    <form  id="Username">
        <div class="d-flex align-items-center justify-content-center">
            <h1>Ingrese su nombre de usuario</h5>
            <input type="text" id="nombreUsuario" required>
            <button onclick="ingresarUsuario()" id="botonUsuario">Ingresar</button>
        </div>
    </form>

    <div class="ruleta-container" id="ruleta">
        <canvas id="canvas" width="500" height="500"></canvas>
        <img src="~/images/flecha.png" class="flecha" alt="Flecha">
        <button class="girarBtn" id="girarBtn" onclick="girarRuleta()">Girar</button>
    </div>

    <div id="resultado-container">
        <div id="resultado"></div>
        <button id="continuarBtn" onclick="continuar()" style="display: none;">Continuar</button>
    </div>
</div>

@section Scripts {
    <script>
        let buttonClicked = false;
        const categorias = ["Historia", "Ciencia", "Geografía", "Arte", "Deportes"];
        const colores = ["#FF6F61", "#6B5B95", "#88B04B", "#F7CAC9", "#92A8D1"];
        const numSecciones = categorias.length;
        const anguloPorSeccion = 2 * Math.PI / numSecciones;
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        const Username = document.getElementById("Username");
        const ruleta = document.getElementById("ruleta");
        const botonNombre = document.getElementById("botonUsuario");
        const nombre = document.getElementById("nombreUsuario");

        ruleta.style.visibility="hidden";

        let anguloInicial = 0;

        function dibujarRuleta() {
            for (let i = 0; i < numSecciones; i++) {
                const anguloFinal = anguloInicial + anguloPorSeccion;
                ctx.beginPath();
                ctx.moveTo(canvas.width / 2, canvas.height / 2);
                ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, anguloInicial, anguloFinal);
                ctx.fillStyle = colores[i];
                ctx.fill();
                ctx.strokeStyle = "#FFFFFF"; // Borde blanco para un diseño más limpio
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.save();

                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.rotate(anguloInicial + anguloPorSeccion / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#FFFFFF";
                ctx.font = "bold 18px Arial";
                ctx.fillText(categorias[i], canvas.width / 2 - 20, 10);
                ctx.restore();

                anguloInicial = anguloFinal;
            }
        }

        function ingresarUsuario(){
            if(nombre.value != ""){
                event.preventDefault();
                Username.style.visibility ="hidden";
                ruleta.style.visibility="visible";
            }
            else{
                botonNombre.disabled = true;
            }
        }

        function girarRuleta() {
            if (buttonClicked) return; // No permitir más clics mientras gira
            buttonClicked = true;

            // Calcular una rotación a la derecha
            const rotacion = Math.floor(Math.random() * 3600) + 360;
            const duracion = 5; // duración en segundos
            canvas.style.transition = `transform ${duracion}s ease-out`;
            canvas.style.transform = `rotate(${rotacion}deg)`;

            setTimeout(() => {
                const anguloFinal = rotacion % 360;
                const indiceGanador = Math.floor(numSecciones - (anguloFinal / 360) * numSecciones) % numSecciones;

                document.getElementById("resultado").textContent = `¡La categoría es: ${categorias[indiceGanador]}! y su usuario es ${nombre.value}`;
                document.getElementById("continuarBtn").style.display = 'block'; // Mostrar el botón Continuar
                document.getElementById("girarBtn").disabled = true; // Deshabilitar el botón Girar
                canvas.style.transition = "none"; // Para permitir más giros posteriores
            }, duracion * 1000);
        }

        function continuar() {
            document.getElementById("continuarBtn").style.display = 'none'; // Ocultar el botón Continuar
            document.getElementById("girarBtn").disabled = false; // Habilitar el botón Girar
        }

        dibujarRuleta();
    </script>
}

<style>
    .ruleta-container {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 50px;
        background: #FFFFFF; /* Fondo blanco */
        border-radius: 10px; /* Bordes redondeados */
        padding: 20px;
    }

    canvas {
        border-radius: 50%; /* Hacer la ruleta redonda */
        /* Se ha eliminado la sombra */
    }

    .flecha {
        position: absolute;
        top: 50%;
        left: 75%; /* Posicionar a la derecha del contenedor */
        transform: translateY(-50%) translateX(-50%) rotate(180deg); /* Ajustar posición y rotar la imagen 180 grados */
        width: 100px; /* Ajuste de tamaño */
        height: 100px; /* Ajuste de tamaño */
        z-index: 10; /* Para que la flecha esté siempre visible encima de la ruleta */
    }

    .girarBtn {
        position: absolute;
        top: 46%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 100px; /* Tamaño redondo */
        height: 100px; /* Tamaño redondo */
        background-color: #2196F3; /* Azul */
        color: #fff;
        border: none;
        border-radius: 50%; /* Redondear el botón */
        font-size: 18px;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.3s, box-shadow 0.3s;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.3); /* Sombra del botón */
    }

    .girarBtn:hover {
        background-color: #1976D2;
        transform: translate(-50%, -50%) scale(1.1); /* Agrandar al pasar el mouse */
        box-shadow: 0px 10px 20px rgba(0, 0, 0, 0.5); /* Sombra más intensa */
    }

    #resultado-container {
        text-align: center;
        margin-top: 20px;
        position: relative;
        padding-bottom: 60px; /* Espacio para el botón Continuar y evitar superposición con el footer */
    }

    #resultado {
        font-size: 24px;
        font-family: 'Arial', sans-serif;
        color: #333333;
    }

    #continuarBtn {
        margin-top: 20px;
        background-color: #2196F3; /* Mismo color que el botón de girar */
        color: #fff;
        border: none;
        border-radius: 10px; /* Bordes redondeados */
        width: 120px; /* Tamaño cuadrado */
        height: 50px; /* Tamaño cuadrado */
        font-size: 18px;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.3s, box-shadow 0.3s;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.3); /* Sombra del botón */
        margin-left: auto;
        margin-right: auto;
    }

    #continuarBtn:hover {
        background-color: #1976D2;
        box-shadow: 0px 10px 20px rgba(0, 0, 0, 0.5); /* Sombra más intensa */
    }
</style>
